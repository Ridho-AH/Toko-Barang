{% extends "base.html" %}

{% load static %}


{% block title %} Home {% endblock title %}


{% block content %}

    <div style="color:#464646; font-style: bold; font-size: 3rem; border-bottom: 1px solid #464646;">Selamat datang, {{ request.user.username }}</div>

    <br>
	<h2 style="color:#464646;">Grafik Seluruh Stok Barang</h2>
    <div id="container" style="position: relative; height:45vh; border: 1.2mm ridge #4e6570; border-radius: 30px;" class="align-middle table-bordered">
        <canvas id="bar-graph"></canvas>
    </div>
	<br>
	<script src="{% static 'js/Chart.min.js' %}"></script>
	
    <script>
        Chart.defaults.global.defaultFontColor = '#3c3c3c';
		window.onload = function() {
			const ctx = [];
			const barConfig = [];
			window.BarStock = [];
			var i = 1;
			ctx[0] = document.getElementById('bar-graph').getContext('2d');
			barConfig[0] = {
				type: 'bar',
				data: {
					datasets: [{
						backgroundColor: '#ba3a3a',
						label: 'Barang Kondisi Buruk',
						data: {{ data2|safe }},
						stack: 'Stack 0',
						},
						{
						backgroundColor: '#3b71ca',
						label: 'Barang Kondisi Baik',
						data: {{ data|safe }},
						stack: 'Stack 0',
					}],
					labels: {{ labels|safe }}
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					scales: {
						y: {
							stacked: true
						  },
						yAxes: [{
							type: 'logarithmic',
							ticks: {
								min: 0,
								userCallback: (value, index) => {
									const remain = value / (Math.pow(10, Math.floor(Chart.helpers.log10(value))));
									if (remain == 1 || remain == 2 || remain == 5 || index == 0) {
										return value.toLocaleString();
									}
									return '';
								}
							}
						}]
					}
				},
			};
			
			window.BarStock[0] = new Chart(ctx[0], barConfig[0]);
		};
    </script>
	
    <br>
	
    <div class="row">
        <div class="col-md-6">
			<a href="{% url 'select-customer' %}" class="btn btn-primary btn-lg btn-block btn-huge">Penjualan Baru</a>
        </div>
		<div class="col-md-6">
            <a href="{% url 'select-supplier' %}" class="btn btn-primary btn-lg btn-block btn-huge">Pembelian Baru</a>
        </div>
    </div>

    <br>

    <div class="content-section">
        <div class="row">

            <div class="col-md-6">
                <div style="color: #4c50af; font-style: bold; font-size: 1.3em; border-bottom: 2px solid #4c50af">Penjualan Terakhir</div><br>
                {% for item in sales %}
                    {% if not forloop.first %}
                        <br><div style="border-bottom: 0.5px solid #4c50af"></div><br>
                    {% endif %}
                    <div class="row">               
                        <div class="col-md-8"> 
                            Nomor Nota Penjualan : #{{ item.billno }} <br> 
                            Dibeli oleh <b>{{ item.customer.name }}</b> <br>
                            <small><i>{{ item.time.date }}</i></small>
                        </div>
                        <div class="col-md-4"> <br> Rp. {{ item.get_total_price }} <br> <a href="{% url 'sale-bill' item.billno %}" style="color: #4c50af">Detil Nota</a> </div>
                    </div>
                {% endfor %}
            </div>

            <div class="col-md-6">
                <div style="color: #4c50af; font-style: bold; font-size: 1.3em; border-bottom: 2px solid #4c50af">Pembelian Terakhir</div><br>
                {% for item in purchases %}
                    {% if not forloop.first %}
                        <br><div style="border-bottom: 0.5px solid #4c50af"></div><br>
                    {% endif %}
                    <div class="row">
                        <div class="col-md-8"> 
                            Nomor Nota Pembelian: #{{ item.billno }} <br> 
                            Dibeli dari <b>{{ item.supplier.name }}</b> <br>
                            <small><i>{{ item.time.date }}</i></small>
                        </div>
                        <div class="col-md-4"> <br>Rp. {{ item.get_total_price }} <br> <a href="{% url 'purchase-bill' item.billno %}" style="color: #4c50af">Detil Nota</a> </div>
                    </div>
                {% endfor %}
            </div>

        </div>
    </div>

    
{% endblock content %}